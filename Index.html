<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIMS CPP v:2.0 ‚Ä¢ Animal Health Laboratory</title>
  <!-- Tailwind CSS (CDN build) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üß™</text></svg>">
  <style>
    /* Light polish for scrollbars and focus states */
    ::-webkit-scrollbar { height: 10px; width: 10px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .btn { @apply inline-flex items-center gap-2 rounded-2xl px-4 py-2 shadow-sm ring-1 ring-black/5 transition hover:shadow-md; }
    .btn-primary { @apply bg-indigo-600 text-white hover:bg-indigo-700; }
    .btn-ghost { @apply bg-white text-slate-700 hover:bg-slate-50; }
    .card { @apply rounded-2xl bg-white shadow-sm ring-1 ring-black/5; }
    .badge { @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ring-1 ring-inset; }
  </style>
  <!-- React/ReactDOM (CDN) + Babel for JSX inline -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Lucide icons -->
  <script type="module">import { createIcons, Home, LayoutDashboard, FlaskConical, Calendar, LogIn, LogOut, FileDown, Upload, Settings, FileText, AlertTriangle } from "https://cdn.skypack.dev/lucide"; window.lucide = { createIcons, Home, LayoutDashboard, FlaskConical, Calendar, LogIn, LogOut, FileDown, Upload, Settings, FileText, AlertTriangle };</script>
  <!-- Supabase JS (for later backend hookup) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.2/dist/umd/supabase.js"></script>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">
  <!-- ===== ENV / CONFIG ===== -->
  <script>
    // ==== GANTI ENV DI SINI (sementara placeholder; isi setelah backend siap) ====
    window.SUPABASE_URL = window.SUPABASE_URL || ""; // e.g. https://xxxx.supabase.co
    window.SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY || ""; // e.g. eyJhbGc...

    // Aplikasi akan berjalan dengan mode MOCK bila kredensial kosong.
  </script>

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // ===== Utils =====
    const cls = (...xs) => xs.filter(Boolean).join(' ');

    // Status color map
    const statusTone = {
      REQUESTED: 'bg-sky-50 text-sky-700 ring-sky-200',
      RECEIVED: 'bg-indigo-50 text-indigo-700 ring-indigo-200',
      IN_PROGRESS: 'bg-amber-50 text-amber-700 ring-amber-200',
      REVIEWED: 'bg-violet-50 text-violet-700 ring-violet-200',
      APPROVED: 'bg-emerald-50 text-emerald-700 ring-emerald-200',
      RELEASED: 'bg-green-50 text-green-700 ring-green-200',
      REJECTED: 'bg-rose-50 text-rose-700 ring-rose-200',
    };

    // Friendly date
    const fmtDate = (d) => d ? new Date(d).toLocaleString() : '-';

    // ===== Supabase (lazy) =====
    let supabase = null;
    function ensureSupabase() {
      if (!supabase && window.SUPABASE_URL && window.SUPABASE_ANON_KEY) {
        supabase = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY, { auth: { persistSession: true } });
      }
      return supabase;
    }

    // ===== API layer (mock-first) =====
    const mockUser = { id: '00000000-0000-0000-0000-000000000000', email: 'demo@ahl.local', name: 'Demo User', role: 'USER' };

    const MOCK = {
      session: null,
      profile: { ...mockUser, division: 'Farm Ops', department: 'Aqua', phone: '‚Äî' },
      labgroups: [
        { lab_group_id: '11111111-1111-1111-1111-111111111111', lab: 'PCR', site: 'MEDAN', status: 'REVIEWED', created_at: '2025-09-01T02:30:00Z', updated_at: '2025-09-02T02:30:00Z', first_accepted_date: '2025-09-01', eta_target: null, submission_id: 'sub-1', user_id: mockUser.id, sample_count: 3, aliquot_count: 3, result_count: 6 },
        { lab_group_id: '22222222-2222-2222-2222-222222222222', lab: 'WQ', site: 'LAMPUNG', status: 'IN_PROGRESS', created_at: '2025-08-31T04:00:00Z', updated_at: '2025-09-01T11:00:00Z', first_accepted_date: '2025-08-31', eta_target: null, submission_id: 'sub-2', user_id: mockUser.id, sample_count: 1, aliquot_count: 2, result_count: 0 },
      ],
      dailyLoad: [
        { lab: 'PCR', site: 'MEDAN', load_date: '2025-09-02', aliquot_accepted: 82, capacity_per_day: 75, warning: 'Load sample sudah melebihi kapasitas, Kemungkinan hasil akan terlambat' },
        { lab: 'WQ', site: 'LAMPUNG', load_date: '2025-09-02', aliquot_accepted: 15, capacity_per_day: 40, warning: null },
      ],
      sla: [
        { lab_group_id: '11111111-1111-1111-1111-111111111111', lab: 'PCR', site: 'MEDAN', status: 'REVIEWED', first_accepted_date: '2025-09-01', sla_days: 7, eta_calc: '2025-09-08', is_overdue: false, updated_at: '2025-09-02T02:30:00Z' },
        { lab_group_id: '22222222-2222-2222-2222-222222222222', lab: 'WQ', site: 'LAMPUNG', status: 'IN_PROGRESS', first_accepted_date: '2025-08-31', sla_days: 7, eta_calc: '2025-09-07', is_overdue: false, updated_at: '2025-09-01T11:00:00Z' },
      ]
    };

    const api = {
      async getSession() {
        const sb = ensureSupabase();
        if (!sb) return { user: null, mock: true };
        const { data: { session } } = await sb.auth.getSession();
        return { user: session?.user || null, mock: false };
      },
      async signInWithGoogle() {
        const sb = ensureSupabase();
        if (!sb) return alert('Mode MOCK: set SUPABASE_URL & SUPABASE_ANON_KEY untuk login.');
        const redirectTo = window.location.href;
        const { error } = await sb.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } });
        if (error) alert(error.message);
      },
      async signOut() {
        const sb = ensureSupabase();
        if (!sb) return; // mock: nothing
        await sb.auth.signOut();
        window.location.reload();
      },
      // Views (backend ready): app.v_my_labgroup_reports
      async fetchLabGroups() {
        const sb = ensureSupabase();
        if (!sb) return { rows: MOCK.labgroups, mock: true };
        const { data, error } = await sb.from('app.v_my_labgroup_reports').select('*').order('updated_at', { ascending: false });
        if (error) { console.warn(error); return { rows: [], mock: false, error } }
        return { rows: data, mock: false };
      },
      // View: app.v_daily_load
      async fetchDailyLoad() {
        const sb = ensureSupabase();
        if (!sb) return { rows: MOCK.dailyLoad, mock: true };
        const { data, error } = await sb.from('app.v_daily_load').select('*').order('load_date', { ascending: false });
        if (error) return { rows: [], error };
        return { rows: data };
      },
      // View: app.v_labgroup_sla
      async fetchSLA() {
        const sb = ensureSupabase();
        if (!sb) return { rows: MOCK.sla, mock: true };
        const { data, error } = await sb.from('app.v_labgroup_sla').select('*').order('eta_calc', { ascending: true });
        if (error) return { rows: [], error };
        return { rows: data };
      },
      // Minimal flow Submit ‚Üí create submission + sampling_event + lab_group (backend RLS must allow)
      async createSubmission(payload) {
        const sb = ensureSupabase();
        if (!sb) { alert('Mode MOCK: simulasikan submit berhasil.'); return { ok: true, submission_id: 'mock-sub' } }
        // 1) submission
        const { data: sub, error: e1 } = await sb.from('app.submission').insert({
          case_type: payload.case_type,
          urgency: payload.urgency,
          anamnesis: payload.anamnesis,
          case_notes: payload.case_notes,
          division: payload.division,
          department: payload.department
        }).select('id').single();
        if (e1) throw e1;
        // 2) sampling_event
        const { error: e2 } = await sb.from('app.sampling_event').insert({
          submission_id: sub.id,
          sampling_datetime: payload.sampling_datetime || null,
          doc: payload.doc || null,
          shipping_date: payload.shipping_date || null,
        });
        if (e2) throw e2;
        // 3) lab_group
        const { error: e3 } = await sb.from('app.lab_group').insert({
          submission_id: sub.id,
          lab: payload.lab,
          site: payload.site,
          status: 'REQUESTED'
        });
        if (e3) throw e3;
        return { ok: true, submission_id: sub.id };
      },
    };

    // ===== UI Components =====
    function Icon({ name, className }) {
      // Basic Lucide fallback using emojis to avoid SSR import issues
      const map = { home: 'üè†', dash: 'üìä', flask: 'üß™', cal: 'üìÖ', login: 'üîê', logout: 'üîì', dl: '‚¨áÔ∏è', up: '‚§¥Ô∏è', warn: '‚ö†Ô∏è' };
      return <span className={className}>{map[name] || '‚Ä¢'}</span>;
    }

    const NavLink = ({ active, onClick, children }) => (
      <button onClick={onClick} className={cls('rounded-xl px-3 py-2 text-sm font-medium', active? 'bg-indigo-600 text-white' : 'text-slate-700 hover:bg-slate-100')}>{children}</button>
    );

    function Navbar({ view, setView, session, onLogin, onLogout }) {
      return (
        <header className="sticky top-0 z-40 border-b bg-white/80 backdrop-blur">
          <div className="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-2xl bg-indigo-600 text-white">AHL</div>
              <div>
                <div className="text-sm text-slate-500">LIMS CPP v:2.0</div>
                <h1 className="text-lg font-semibold">Animal Health Laboratory</h1>
              </div>
            </div>
            <nav className="flex items-center gap-2">
              <NavLink active={view==='home'} onClick={()=>setView('home')}>Home</NavLink>
              <NavLink active={view==='dashboard'} onClick={()=>setView('dashboard')}>Dashboard</NavLink>
              <NavLink active={view==='submit'} onClick={()=>setView('submit')}>Submit Sample</NavLink>
              <NavLink active={view==='calendar'} onClick={()=>setView('calendar')}>Calendar</NavLink>
            </nav>
            <div className="flex items-center gap-3">
              {session?.user ? (
                <>
                  <div className="hidden sm:block text-sm text-slate-600">{session.user.email}</div>
                  <button className="btn btn-ghost" onClick={onLogout}><Icon name="logout"/> Logout</button>
                </>
              ) : (
                <button className="btn btn-primary" onClick={onLogin}><Icon name="login"/> Login with Google</button>
              )}
            </div>
          </div>
        </header>
      );
    }

    function StatCard({ title, value, sub }) {
      return (
        <div className="card p-4">
          <div className="text-sm text-slate-500">{title}</div>
          <div className="mt-1 text-3xl font-semibold">{value}</div>
          {sub && <div className="mt-1 text-xs text-slate-500">{sub}</div>}
        </div>
      );
    }

    function HomeView() {
      return (
        <main className="mx-auto max-w-7xl px-4 py-10">
          <section className="grid gap-6 md:grid-cols-3">
            <StatCard title="Sites" value="4" sub="Central, Medan, Lampung, Situbondo"/>
            <StatCard title="Labs" value="5" sub="PCR, Mikrobiologi, WQ, Histopatologi, Imunoserologi"/>
            <StatCard title="SPREC Ready" value="Yes" sub="Specimen transport, processing, storage"/>
          </section>

          <section className="mt-8 grid gap-6 md:grid-cols-2">
            <div className="card p-6">
              <h2 className="text-xl font-semibold">Purpose</h2>
              <p className="mt-2 text-sm text-slate-600">A unified LIMS for aquaculture matrices (fish, shrimp, feed, sludge, culture water, and others), enabling data integrity, audit trail, cold-chain traceability, and SLA-driven operations.</p>
              <ul className="mt-4 list-disc pl-5 text-sm text-slate-600 space-y-2">
                <li>Multi-site, multi-lab workflow with SPREC fields on sample/aliquot.</li>
                <li>Capacity-aware intake and ETA prediction for results.</li>
                <li>Private report storage with authenticated download.</li>
              </ul>
            </div>
            <div className="card p-6">
              <h2 className="text-xl font-semibold">Quick Actions</h2>
              <div className="mt-4 flex flex-wrap gap-3">
                <a href="#" className="btn btn-primary" onClick={(e)=>{e.preventDefault(); window.appSetView('submit')}}><Icon name="flask"/> Submit Sample</a>
                <a href="#" className="btn btn-ghost" onClick={(e)=>{e.preventDefault(); window.appSetView('dashboard')}}><Icon name="dash"/> Open Dashboard</a>
                <a href="#" className="btn btn-ghost" onClick={(e)=>{e.preventDefault(); window.appSetView('calendar')}}><Icon name="cal"/> View Calendar</a>
              </div>
              <p className="mt-4 text-xs text-slate-500">Deployed on GitHub Pages. Configure <code>window.SUPABASE_URL</code> and <code>window.SUPABASE_ANON_KEY</code> to enable live backend.</p>
            </div>
          </section>
        </main>
      );
    }

    function BadgeStatus({ s }) { return <span className={cls('badge', statusTone[s] || 'bg-slate-50 text-slate-700 ring-slate-200')}>{s}</span> }

    function DashboardView() {
      const [rows, setRows] = useState([]);
      const [load, setLoad] = useState([]);
      const [sla, setSla] = useState([]);

      useEffect(()=>{ (async()=>{
        const a = await api.fetchLabGroups(); setRows(a.rows || []);
        const b = await api.fetchDailyLoad(); setLoad(b.rows || []);
        const c = await api.fetchSLA(); setSla(c.rows || []);
      })(); }, []);

      return (
        <main className="mx-auto max-w-7xl px-4 py-8 space-y-8">
          <section className="grid gap-4 md:grid-cols-3">
            <StatCard title="My Lab Groups" value={rows.length} />
            <StatCard title="Loads Today (sites)" value={new Set(load.map(x=>x.site+':'+x.lab)).size} />
            <StatCard title="Overdue" value={sla.filter(x=>x.is_overdue).length} />
          </section>

          <section className="card p-4">
            <div className="flex items-center justify-between">
              <h2 className="text-lg font-semibold">Lab Groups</h2>
            </div>
            <div className="mt-3 overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead>
                  <tr className="text-left text-slate-500">
                    <th className="py-2 pr-3">Lab Group</th>
                    <th className="py-2 pr-3">Lab/Site</th>
                    <th className="py-2 pr-3">Status</th>
                    <th className="py-2 pr-3">Samples</th>
                    <th className="py-2 pr-3">Aliquots</th>
                    <th className="py-2 pr-3">Results</th>
                    <th className="py-2 pr-3">Updated</th>
                  </tr>
                </thead>
                <tbody>
                {rows.map(r=> (
                  <tr key={r.lab_group_id} className="border-t">
                    <td className="py-2 pr-3 font-medium text-slate-700">{r.lab_group_id.slice(0,8)}‚Ä¶</td>
                    <td className="py-2 pr-3">{r.lab} / {r.site}</td>
                    <td className="py-2 pr-3"><BadgeStatus s={r.status}/></td>
                    <td className="py-2 pr-3">{r.sample_count}</td>
                    <td className="py-2 pr-3">{r.aliquot_count}</td>
                    <td className="py-2 pr-3">{r.result_count}</td>
                    <td className="py-2 pr-3 text-slate-500">{fmtDate(r.updated_at)}</td>
                  </tr>
                ))}
                {rows.length===0 && (
                  <tr><td colSpan="7" className="py-6 text-center text-slate-500">No data yet.</td></tr>
                )}
                </tbody>
              </table>
            </div>
          </section>

          <section className="grid gap-6 md:grid-cols-2">
            <div className="card p-4">
              <h3 className="text-lg font-semibold">Daily Load vs Capacity</h3>
              <div className="mt-3 overflow-x-auto">
                <table className="min-w-full text-sm">
                  <thead>
                    <tr className="text-left text-slate-500">
                      <th className="py-2 pr-3">Date</th>
                      <th className="py-2 pr-3">Lab/Site</th>
                      <th className="py-2 pr-3">Accepted</th>
                      <th className="py-2 pr-3">Capacity</th>
                      <th className="py-2 pr-3">Warning</th>
                    </tr>
                  </thead>
                  <tbody>
                  {load.map((x,i)=> (
                    <tr key={i} className="border-t">
                      <td className="py-2 pr-3">{x.load_date}</td>
                      <td className="py-2 pr-3">{x.lab} / {x.site}</td>
                      <td className="py-2 pr-3">{x.aliquot_accepted}</td>
                      <td className="py-2 pr-3">{x.capacity_per_day}</td>
                      <td className="py-2 pr-3 text-amber-700">{x.warning || ''}</td>
                    </tr>
                  ))}
                  {load.length===0 && (
                    <tr><td colSpan="5" className="py-6 text-center text-slate-500">No load recorded.</td></tr>
                  )}
                  </tbody>
                </table>
              </div>
            </div>
            <div className="card p-4">
              <h3 className="text-lg font-semibold">SLA & ETA</h3>
              <div className="mt-3 overflow-x-auto">
                <table className="min-w-full text-sm">
                  <thead>
                    <tr className="text-left text-slate-500">
                      <th className="py-2 pr-3">Lab Group</th>
                      <th className="py-2 pr-3">Lab/Site</th>
                      <th className="py-2 pr-3">First Accepted</th>
                      <th className="py-2 pr-3">SLA (d)</th>
                      <th className="py-2 pr-3">ETA</th>
                      <th className="py-2 pr-3">Overdue</th>
                    </tr>
                  </thead>
                  <tbody>
                    {sla.map(s=> (
                      <tr key={s.lab_group_id} className="border-t">
                        <td className="py-2 pr-3 font-medium">{s.lab_group_id.slice(0,8)}‚Ä¶</td>
                        <td className="py-2 pr-3">{s.lab} / {s.site}</td>
                        <td className="py-2 pr-3">{s.first_accepted_date || '‚Äî'}</td>
                        <td className="py-2 pr-3">{s.sla_days}</td>
                        <td className="py-2 pr-3">{s.eta_calc || '‚Äî'}</td>
                        <td className="py-2 pr-3">{s.is_overdue ? <span className="badge bg-rose-50 text-rose-700 ring-rose-200">Yes</span> : <span className="badge bg-emerald-50 text-emerald-700 ring-emerald-200">No</span>}</td>
                      </tr>
                    ))}
                    {sla.length===0 && (
                      <tr><td colSpan="6" className="py-6 text-center text-slate-500">No SLA data.</td></tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        </main>
      );
    }

    function Field({ label, children }) {
      return (
        <label className="grid gap-1 text-sm">
          <div className="text-slate-700">{label}</div>
          {children}
        </label>
      );
    }

    function SubmitView() {
      const [form, setForm] = useState({
        case_type: 'MONITORING', urgency: 'MEDIUM', anamnesis: '', case_notes: '', division: '', department: '',
        sampling_datetime: '', doc: '', shipping_date: '', lab: 'PCR', site: 'CENTRAL'
      });
      const [submitting, setSubmitting] = useState(false);

      const onChange = (k) => (e)=> setForm(f=> ({...f, [k]: e.target.value }));

      const onSubmit = async (e)=>{
        e.preventDefault();
        setSubmitting(true);
        try {
          const res = await api.createSubmission({ ...form, doc: form.doc? Number(form.doc) : null });
          if (res.ok) {
            alert('Submission created. ID: ' + res.submission_id + '\nLab Group status: REQUESTED');
            setForm({ case_type: 'MONITORING', urgency: 'MEDIUM', anamnesis: '', case_notes: '', division: '', department: '', sampling_datetime: '', doc: '', shipping_date: '', lab: 'PCR', site: 'CENTRAL' });
          }
        } catch (err) {
          console.error(err);
          alert('Failed: ' + (err.message || 'Unknown error'));
        } finally {
          setSubmitting(false);
        }
      };

      return (
        <main className="mx-auto max-w-3xl px-4 py-8">
          <form onSubmit={onSubmit} className="card p-6 grid gap-4">
            <h2 className="text-xl font-semibold">Submit Sample</h2>
            <div className="grid gap-4 md:grid-cols-2">
              <Field label="Case Type">
                <select value={form.case_type} onChange={onChange('case_type')} className="rounded-xl border-slate-300">
                  <option value="MONITORING">Monitoring</option>
                  <option value="KASUS">Kasus</option>
                </select>
              </Field>
              <Field label="Urgency">
                <select value={form.urgency} onChange={onChange('urgency')} className="rounded-xl border-slate-300">
                  <option value="LOW">Low</option>
                  <option value="MEDIUM">Medium</option>
                  <option value="HIGH">High</option>
                </select>
              </Field>
            </div>

            <Field label="Anamnesis / Keterangan">
              <textarea value={form.anamnesis} onChange={onChange('anamnesis')} className="rounded-xl border-slate-300" rows="3" placeholder="Riwayat kasus / tujuan monitoring" />
            </Field>

            <div className="grid gap-4 md:grid-cols-2">
              <Field label="Division">
                <input value={form.division} onChange={onChange('division')} className="rounded-xl border-slate-300" placeholder="Divisi pengaju" />
              </Field>
              <Field label="Department">
                <input value={form.department} onChange={onChange('department')} className="rounded-xl border-slate-300" placeholder="Departemen pengaju" />
              </Field>
            </div>

            <div className="grid gap-4 md:grid-cols-3">
              <Field label="Sampling Datetime">
                <input type="datetime-local" value={form.sampling_datetime} onChange={onChange('sampling_datetime')} className="rounded-xl border-slate-300" />
              </Field>
              <Field label="DOC (Day of Culture)">
                <input type="number" min="0" value={form.doc} onChange={onChange('doc')} className="rounded-xl border-slate-300" />
              </Field>
              <Field label="Shipping Date">
                <input type="date" value={form.shipping_date} onChange={onChange('shipping_date')} className="rounded-xl border-slate-300" />
              </Field>
            </div>

            <div className="grid gap-4 md:grid-cols-2">
              <Field label="Lab Tujuan">
                <select value={form.lab} onChange={onChange('lab')} className="rounded-xl border-slate-300">
                  <option>PCR</option>
                  <option>MIKROBIOLOGI</option>
                  <option>WQ</option>
                  <option>HISTO</option>
                  <option>IMUNO</option>
                </select>
              </Field>
              <Field label="Site">
                <select value={form.site} onChange={onChange('site')} className="rounded-xl border-slate-300">
                  <option>CENTRAL</option>
                  <option>MEDAN</option>
                  <option>LAMPUNG</option>
                  <option>SITUBONDO</option>
                </select>
              </Field>
            </div>

            <div className="flex items-center gap-3 pt-2">
              <button className="btn btn-primary" disabled={submitting} type="submit">
                {submitting ? 'Submitting‚Ä¶' : 'Submit'}
              </button>
              <span className="text-xs text-slate-500">Status awal akan <b>REQUESTED</b>. Admin akan memverifikasi pada saat kedatangan fisik.</span>
            </div>
          </form>
        </main>
      );
    }

    function CalendarView() {
      const today = new Date();
      const [month, setMonth] = useState(today.getMonth());
      const [year, setYear] = useState(today.getFullYear());

      const days = useMemo(()=>{
        const first = new Date(year, month, 1);
        const start = new Date(first);
        start.setDate(first.getDate() - ((first.getDay()+6)%7)); // start from Monday
        const arr = [];
        for (let i=0;i<42;i++) { const d = new Date(start); d.setDate(start.getDate()+i); arr.push(d); }
        return arr;
      }, [month, year]);

      return (
        <main className="mx-auto max-w-5xl px-4 py-8">
          <div className="card p-4">
            <div className="flex items-center justify-between">
              <div className="text-lg font-semibold">{new Date(year, month).toLocaleString(undefined, { month: 'long', year: 'numeric' })}</div>
              <div className="flex gap-2">
                <button className="btn btn-ghost" onClick={()=>{ const d=new Date(year,month-1); setYear(d.getFullYear()); setMonth(d.getMonth()); }}>Prev</button>
                <button className="btn btn-ghost" onClick={()=>{ const d=new Date(year,month+1); setYear(d.getFullYear()); setMonth(d.getMonth()); }}>Next</button>
              </div>
            </div>
            <div className="mt-4 grid grid-cols-7 gap-2 text-center text-xs text-slate-500">
              {['Mon','Tue','Wed','Thu','Fri','Sat','Sun'].map(d=> <div key={d} className="py-1">{d}</div>)}
            </div>
            <div className="mt-1 grid grid-cols-7 gap-2">
              {days.map((d,i)=>{
                const isCurr = d.getMonth()===month;
                const isToday = d.toDateString()=== (new Date()).toDateString();
                return (
                  <div key={i} className={cls('rounded-xl border p-2 min-h-[80px] text-sm', isCurr? 'bg-white border-slate-200' : 'bg-slate-50 border-slate-100', isToday && 'ring-2 ring-indigo-500')}>
                    <div className={cls('text-right', isCurr? 'text-slate-700':'text-slate-400')}>{d.getDate()}</div>
                    {/* placeholder for events (ETA, deadlines) */}
                  </div>
                );
              })}
            </div>
            <p className="mt-4 text-xs text-slate-500">Calendar can display <b>ETA</b> from <code>app.v_labgroup_sla</code> and accepted loads. Hook it up after backend config.</p>
          </div>
        </main>
      );
    }

    function App() {
      const [view, setView] = useState('home');
      const [session, setSession] = useState(null);
      window.appSetView = setView; // for quick actions

      useEffect(()=>{ (async()=>{
        const s = await api.getSession(); setSession(s);
      })(); }, []);

      return (
        <div>
          <Navbar view={view} setView={setView} session={session} onLogin={()=>api.signInWithGoogle()} onLogout={()=>api.signOut()} />
          {view==='home' && <HomeView/>}
          {view==='dashboard' && <DashboardView/>}
          {view==='submit' && <SubmitView/>}
          {view==='calendar' && <CalendarView/>}
          <footer className="mt-16 border-t">
            <div className="mx-auto max-w-7xl px-4 py-6 text-sm text-slate-500 flex items-center justify-between">
              <div>Provided by: <b>Animal Health Laboratory</b></div>
              <div>&copy; {new Date().getFullYear()} ‚Ä¢ LIMS CPP v:2.0</div>
            </div>
          </footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>

  <!-- ===== Quick README (inline) ===== -->
  <script>
    /*
    =============================
    DEPLOY TO GITHUB PAGES
    =============================
    1) Buat repo GitHub baru (public/private).
    2) Commit file ini sebagai `index.html` di root repository.
    3) Aktifkan GitHub Pages: Settings ‚Üí Pages ‚Üí Source: `Deploy from a branch`; Branch: `main` (root).
    4) Buka URL Pages yang diberikan (mis. https://username.github.io/repo/).

    Backend hookup:
    - Edit variabel di atas: window.SUPABASE_URL & window.SUPABASE_ANON_KEY.
    - Pastikan SQL backend (skema `app`) sudah terpasang dan RLS siap.
    - Login tombol ‚Üí Google OAuth Supabase.

    Keamanan:
    - Anon key bersifat publik, namun RLS membatasi akses data.
    - Gunakan domain redirect OAuth yang diizinkan di Supabase Auth Settings.

    Penyesuaian UI:
    - Tambah field SPREC & Aliquot barcode saat Anda siap menyambungkan.
    */
  </script>
</body>
</html>
